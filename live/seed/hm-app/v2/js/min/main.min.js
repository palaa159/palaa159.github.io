function customIndexOf(t,e){var n=-1;return _.some(t,function(t,a){return e.toLowerCase().replace(/\s+/g,"")===t.Name.toLowerCase().replace(/\s+/g,"")?(n=a,!0):!1}),n}var app=app||{};app.main=function(){var t,e,n,a,r,o=[],s=[],i=["Category – People","Category – Product","Category – Place"],c=["Link – Product","Link – Product Family","Link – Product Category","Link – Customer","Link – Customer Segment","Link – Dealer","Link – Employee","Link – Region","Link – Category","Link – MSA","Link – Time","Link – Product Line","Link – Product Type","Link – Sales Representative"],l=["Department – Design/Development","Department – IT","Department – Sales","Department – Marketing","Department – Performance Environments","Department – Product Management","Department – Research"],u=["1","2","3"],d="#baff12",p="#feb612",h="#14a2fa",f=function(){var t="data/inventory.csv";queue().defer(d3.csv,t).await(function(t,e){o=e,m()})},m=function(){console.log("finished loading data"),g(),window.location.hash="",window.location.hash="/search",v()},g=function(){console.log("listening page"),$(window).on("hashchange",function(){var t=window.location.hash;$("a").removeClass("selected"),$('a[href="'+t+'"]').addClass("selected"),y(t),v()})},y=function(o){var s,i;$("#view").html(""),$("svg").remove(),t&&t.stop(),$(".d3-tip").remove(),"#/search"===o?(e="Any",n="Any",a="Any",r="Any",s=$("#tpl-filter").html(),i=_.template(s),$("#view").html(i),k()):"#/vis_all"===o&&(s=$("#tpl-network").html(),i=_.template(s),$("#view").html(i),w("networkgraph.csv",u))},v=function(){$("#sel_freq_updated").off("change").on("change",function(){e=$(this).val()}),$("#sel_used_by").off("change").on("change",function(){n=$(this).val()}),$("#sel_linked_to").off("change").on("change",function(){a=$(this).val()}),$("#sel_relevant_to").off("change").on("change",function(){r=$(this).val()}),$("#btn_submit").off("click").on("click",function(){k()})},k=function(){$(window).off("resize"),console.log("empty output"),s=[],console.log("filter#1: "+e),console.log("filter#2: "+n),console.log("filter#3: "+a),console.log("filter#4: "+r);var t=[],i=[],c=[],l=[];_.each(o,function(o){"Any"!==e&&o[$("#field_freq_updated").text()]===e?t.push(o):"Any"===e&&t.push(o),"Any"!==n&&o["Used By Department 1"]===n||o["Used By Department 2"]===n||o["Used By Department 3"]===n||o["Used By Department 4"]===n?i.push(o):"Any"===n&&i.push(o),"Any"!==a&&o["Linkable Data 1"]===a||o["Linkable Data 2"]===a||o["Linkable Data 3"]===a?c.push(o):"Any"===a&&c.push(o),"Any"!==r&&"1"===o[r]?l.push(o):"Any"===r&&l.push(o)}),s=_.intersection(t,i,c,l),$("#number_of_resources").html(s.length+" of "+o.length+" Data Resources found");var u=$("#tpl-result").html(),d=_.template(u,{array:s});$("#result_container").html(d),$(".tb_result").fadeIn()},w=function(e){$("svg").remove();var n=window.innerWidth,a=window.innerHeight,r=d3.select("#view").append("svg").attr("width",n).attr("height",a);t&&t.stop(),t=d3.layout.force().size([n,a]).charge(-300).linkDistance(80),d3.csv("data/vis/"+e,function(e){function n(){m.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),v.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),y.attr({dx:function(t){return t.x+8},dy:function(t){return t.y-10}})}function a(t){return s[t.replace(/\u00a0/g," ")]||(s[t.replace(/\u00a0/g," ")]={name:t.replace(/\u00a0/g," ")})}var s={};stats=0,console.log(u),e.forEach(function(t){u.forEach(function(e){t.target_type===e&&(t.source=a(t.source),t.target=a(t.target),stats+=1)})});var f=d3.values(s);$(".graphStats").html(f.length+" Nodes Displayed<br>"+stats+" Edges Displayed");var m=r.selectAll(".link").data(e).enter().append("line").attr({"data-source":function(t){return t.source.name},"data-target":function(t){return t.target.name},stroke:function(t){return"1"===t.target_type?(d3.select(this).attr({"class":"graph-data link i_cat"}),d):"2"===t.target_type?(d3.select(this).attr({"class":"graph-data link i_dep"}),h):"3"===t.target_type?(d3.select(this).attr({"class":"graph-data link i_link"}),p):"#000"}});$(".d3-tip").remove();var g=d3.tip().attr("class","d3-tip").html(function(t){return t.data_tooltip}),y=r.selectAll("g").data(f).enter().append("text").text(function(t){return _.contains(c,t.name)?(d3.select(this).attr({"class":"graph-data text"}),t.name):_.contains(i,t.name)?(d3.select(this).attr({"class":"graph-data text"}),t.name):_.contains(l,t.name)?(d3.select(this).attr({"class":"graph-data text"}),t.name):void 0}),v=r.selectAll("g").data(f).enter().append("circle").attr({"data-name":function(t){return t.name.replace(/\u00a0/g," ")},r:function(t){return t.data_tooltip=L(t.name),_.contains(i,t.name)?(d3.select(this).attr({"class":"graph-data node"}),10):_.contains(c,t.name)?(d3.select(this).attr({"class":"graph-data node"}),10):_.contains(l,t.name)?(d3.select(this).attr({"class":"graph-data node"}),10):(d3.select(this).attr({"class":"graph-data node i_genpop"}),3)},fill:function(t){return _.contains(i,t.name)?d:_.contains(l,t.name)?h:_.contains(c,t.name)?p:"#c4c4c4"}}).on("mouseover",g.show).on("mouseout",g.hide).call(t.drag).call(g);t.nodes(f).links(e).on("tick",n).friction(.6).start(),o()}),$(".networkGraphOptionInput").off("change").on("change",function(){o(),w("networkgraph.csv",u)});var o=function(){u=[],$.each($(".networkGraphOptionInput:checked"),function(t,e){u.push($(e).val())})},s=_.debounce(D,150);$(window).off("resize").on("resize",s)},D=function(){w("networkgraph.csv",u)},L=function(t){var e=customIndexOf(o,t);return o[e]?'<span style="font-size: 1.25em; line-height: 1.25em; margin-bottom: 9px">'+o[e].Name+'</span><br><span style="line-height: 1.35em;">Owned by: '+(""!==o[e]["Used By Department 1"]?o[e]["Used By Department 1"]:"")+(""!==o[e]["Used By Department 2"]?", "+o[e]["Used By Department 2"]:"")+(""!==o[e]["Used By Department 3"]?", "+o[e]["Used By Department 3"]:"")+(""!==o[e]["Used By Department 4"]?", "+o[e]["Used By Department 4"]:"")+"<br>Frequency Updated: "+o[e]["Frequency Updated"]+"<br>Frequency Used: "+o[e]["Frequency Used"]+"</span>":t};return{init:m,load:f}}(),app.main.load();