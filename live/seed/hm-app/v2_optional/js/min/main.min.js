var app=app||{};app.main=function(){var t,e,n,a,i,r=[],o=[],c=["Category – People","Category – Product","Category – Place"],s=["Link – Product","Link – Product Family","Link – Product Category","Link – Customer","Link – Customer Segment","Link – Dealer","Link – Employee","Link – Region","Link – Category","Link – MSA","Link – Time","Link – Product Line","Link – Product Type","Link – Sales Representative"],l=["Department – Design/Development","Department – IT","Department – Sales","Department – Marketing","Department – Performance Environments","Department – Product Management","Department – Research"],d="#baff12",u="#feb612",h="#14a2fa",p=function(){var t="data/inventory.csv";queue().defer(d3.csv,t).await(function(t,e){r=e,f()})},f=function(){console.log("finished loading data"),g(),window.location.hash="",window.location.hash="/search",v()},g=function(){console.log("listening page"),$(window).on("hashchange",function(){var t=window.location.hash;$("a").removeClass("selected"),$('a[href="'+t+'"]').addClass("selected"),m(t),v()})},m=function(r){if($("#view").html(""),$("svg").remove(),t&&t.stop(),$(".d3-tip").remove(),"#/search"===r){e="Any",n="Any",a="Any",i="Any";var o=$("#tpl-filter").html(),c=_.template(o);$("#view").html(c),y()}else"#/vis_all"===r&&k("networkgraph.csv")},v=function(){$("#sel_freq_updated").off("change").on("change",function(){e=$(this).val()}),$("#sel_used_by").off("change").on("change",function(){n=$(this).val()}),$("#sel_linked_to").off("change").on("change",function(){a=$(this).val()}),$("#sel_relevant_to").off("change").on("change",function(){i=$(this).val()}),$("#btn_submit").off("click").on("click",function(){y()})},y=function(){console.log("empty output"),o=[],console.log("filter#1: "+e),console.log("filter#2: "+n),console.log("filter#3: "+a),console.log("filter#4: "+i);var t=[],c=[],s=[],l=[];_.each(r,function(r){"Any"!==e&&r[$("#field_freq_updated").text()]===e?t.push(r):"Any"===e&&t.push(r),"Any"!==n&&r["Used By Department 1"]===n||r["Used By Department 2"]===n||r["Used By Department 3"]===n||r["Used By Department 4"]===n?c.push(r):"Any"===n&&c.push(r),"Any"!==a&&r["Linkable Data 1"]===a||r["Linkable Data 2"]===a||r["Linkable Data 3"]===a?s.push(r):"Any"===a&&s.push(r),"Any"!==i&&"1"===r[i]?l.push(r):"Any"===i&&l.push(r)}),o=_.intersection(t,c,s,l),$("#number_of_resources").html(o.length+" of "+r.length+" Data Resources found");var d=$("#tpl-result").html(),u=_.template(d,{array:o});$("#result_container").html(u),$(".tb_result").fadeIn()},k=function(e){var n=window.innerWidth,a=window.innerHeight,i=$("#tpl-d3").html(),r=_.template(i);$("#view").html(r);var o=d3.select("#view").append("svg").attr("width",n).attr("height",a);t&&t.stop(),t=d3.layout.force().size([n,a]).charge(-300).linkDistance(80),d3.csv("data/vis/"+e,function(e){function n(){f.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),v.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),m.attr({dx:function(t){return t.x+8},dy:function(t){return t.y-10}})}function a(t){return i[t]||(i[t]={name:t})}var i={};e.forEach(function(t){t.source=a(t.source),t.target=a(t.target)});var r=d3.values(i),f=o.selectAll(".link").data(e).enter().append("line").attr({stroke:function(t){return"1"===t.target_type?(d3.select(this).attr({"class":"graph-data link i_cat"}),d):"2"===t.target_type?(d3.select(this).attr({"class":"graph-data link i_dep"}),h):"3"===t.target_type?(d3.select(this).attr({"class":"graph-data link i_link"}),u):"#000"}});$(".d3-tip").remove();var g=d3.tip().attr("class","d3-tip").html(function(t){return t.name}),m=o.selectAll("g").data(r).enter().append("text").text(function(t){return _.contains(s,t.name)?(d3.select(this).attr({"class":"graph-data text i_link"}),t.name):_.contains(c,t.name)?(d3.select(this).attr({"class":"graph-data text i_cat"}),t.name):_.contains(l,t.name)?(d3.select(this).attr({"class":"graph-data text i_dep"}),t.name):void 0}),v=o.selectAll("g").data(r).enter().append("circle").attr({r:function(t){return _.contains(c,t.name)?(d3.select(this).attr({"class":"graph-data node i_cat"}),10):_.contains(s,t.name)?(d3.select(this).attr({"class":"graph-data node i_link"}),10):_.contains(l,t.name)?(d3.select(this).attr({"class":"graph-data node i_dep"}),10):(d3.select(this).attr({"class":"graph-data node i_genpop"}),3)},fill:function(t){return _.contains(c,t.name)?d:_.contains(l,t.name)?h:_.contains(s,t.name)?u:"#c4c4c4"}}).on("mouseover",g.show).on("mouseout",g.hide).call(t.drag).call(g);t.nodes(r).links(e).on("tick",n).start(),p()}),$(".networkGraphOptionInput").on("change",function(){$(".i_dep").hide(),$(".i_cat").hide(),$(".i_link").hide(),p()});var p=function(){$.each($(".networkGraphOptionInput:checked"),function(t,e){$("."+$(e).val()).show()});var t=$(".graph-data.node");$.each(t,function(t,e){console.log($(e).css("display"))})},f=_.debounce(w,150);$(window).off("resize").on("resize",f)},w=function(){k("networkgraph.csv")};return{init:f,load:p}}(),app.main.load();