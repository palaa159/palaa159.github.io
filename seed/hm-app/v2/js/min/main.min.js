var app=app||{};app.main=function(){var n,t,e,a,o,r=[],i=[],c=["People","Product","Place"],s=["Product","Product Family","Product Category","Customer","Customer Segment","Dealer","Employee","Region"],l=["Design/Development","IT","Marketing","Performance Environments","Product Management","Research","Sales"],u=function(){var n="data/inventory.csv";queue().defer(d3.csv,n).await(function(n,t){r=t,f()})},f=function(){console.log("finished loading data"),d(),window.location.hash="",window.location.hash="/search",h()},d=function(){console.log("listening page"),$(window).on("hashchange",function(){var n=window.location.hash;$("a").removeClass("selected"),$('a[href="'+n+'"]').addClass("selected"),p(n),h()})},p=function(r){if($("#view").html(""),$("svg").remove(),n&&n.stop(),$(".d3-tip").remove(),"#/search"===r){t="Any",e="Any",a="Any",o="Any";var i=$("#tpl-filter").html(),c=_.template(i);$("#view").html(c),m()}else"#/vis_all"===r?g("all.csv"):"#/vis_ppp"===r?g("ppp.csv"):"#/vis_linkage"===r?g("linkage.csv"):"#/vis_department"===r&&g("department.csv")},h=function(){$("#sel_freq_updated").off("change").on("change",function(){t=$(this).val()}),$("#sel_used_by").off("change").on("change",function(){e=$(this).val()}),$("#sel_linked_to").off("change").on("change",function(){a=$(this).val()}),$("#sel_relevant_to").off("change").on("change",function(){o=$(this).val()}),$("#btn_submit").off("click").on("click",function(){m()})},m=function(){console.log("empty output"),i=[],console.log("filter#1: "+t),console.log("filter#2: "+e),console.log("filter#3: "+a),console.log("filter#4: "+o);var n=[],c=[],s=[],l=[];_.each(r,function(r){"Any"!==t&&r[$("#field_freq_updated").text()]===t?n.push(r):"Any"===t&&n.push(r),"Any"!==e&&r["Used By Department 1"]===e||r["Used By Department 2"]===e||r["Used By Department 3"]===e||r["Used By Department 4"]===e?c.push(r):"Any"===e&&c.push(r),"Any"!==a&&r["Linkable Data 1"]===a||r["Linkable Data 2"]===a||r["Linkable Data 3"]===a?s.push(r):"Any"===a&&s.push(r),"Any"!==o&&"1"===r[o]?l.push(r):"Any"===o&&l.push(r)}),i=_.intersection(n,c,s,l),$("#number_of_resources").html(i.length+" of "+r.length+" Data Resources found");var u=$("#tpl-result").html(),f=_.template(u,{array:i});$("#result_container").html(f),$(".tb_result").fadeIn()},g=function(t){var e=window.innerWidth,a=window.innerHeight,o=d3.select("#view").append("svg").attr("width",e).attr("height",a);n=d3.layout.force().size([e,a]).charge(-300).linkDistance(80),d3.csv("data/vis/"+t,function(t){function e(){u.attr("x1",function(n){return n.source.x}).attr("y1",function(n){return n.source.y}).attr("x2",function(n){return n.target.x}).attr("y2",function(n){return n.target.y}),p.attr("cx",function(n){return n.x}).attr("cy",function(n){return n.y}),d.attr({dx:function(n){return n.x+8},dy:function(n){return n.y-10}})}function a(n){return r[n]||(r[n]={name:n})}var r={};t.forEach(function(n){n.source=a(n.source),n.target=a(n.target)});var i=d3.values(r),u=o.selectAll(".link").data(t).enter().append("line").attr({"class":"link",stroke:function(n){return"1"===n.target_type?"#00F2FF":"2"===n.target_type?"#FF7040":"3"===n.target_type?"#CC2814":"#000"}}),f=d3.tip().attr("class","d3-tip").html(function(n){return n.name}),d=o.selectAll("g").data(i).enter().append("text").attr({"class":"text"}).text(function(n){return _.contains(s,n.name)||_.contains(c,n.name)||_.contains(l,n.name)?n.name:void 0}),p=o.selectAll("g").data(i).enter().append("circle").attr({"class":"node",r:function(n){return _.contains(c,n.name)?10:_.contains(s,n.name)?10:_.contains(l,n.name)?10:4},fill:function(n){return _.contains(c,n.name)?"#00F2FF":_.contains(l,n.name)?"#FF7040":_.contains(s,n.name)?"#CC2814":"#000"}}).on("mouseover",f.show).on("mouseout",f.hide).call(n.drag).call(f);n.nodes(i).links(t).on("tick",e).start()})};return{init:f,load:u}}(),app.main.load();